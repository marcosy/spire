# Server plugin: UpstreamCA "disk"

The `disk` plugin loads CA credentials from disk, using them to generate
intermediate signing certificates for the server's signing authority. The
intermediate certificates are minted against CSRs generated by the ServerCA
plugin.

The `disk` plugin reloads CA credentials on all CSR requests. If the
credentials cannot be loaded, then the previously loaded credentials will be used.
This provides two things: first, it ensures that the spire-server process does not
need to be restarted to load a new UpstreamCA from disk, providing a seamless rotation;
second, it ensures that a failed disk does not effect a running spire-server until the
loaded UpstreamCA expires.

The plugin accepts the following configuration options:

| Configuration   | Description                                          |
| ----------------| ---------------------------------------------------- |
| ttl             | The TTL for issued certificates                      |
| cert_file_path  | Path to the "upstream" CA certificate                |
| key_file_path   | Path to the "upstream" CA key file                   |
| bundle_file_path| Path to the trust bundle that signed the upstream CA |

The `disk` plugin is able to function as either a root CA, or join an existing PKI.
When joining an existing PKI, the trust bundle for that PKI may be set explicitly
using the `bundle_file_path` option; this must contain the certificates of the trusted
roots for the PKI being joined in PEM format. When using the `bundle_file_path` option
`cert_file_path` must contain a chain of certificates, in PEM format, up to the trusted 
root. Alternatively, `cert_file_path` may contain a chain of certificates, in PEM format,
up to and including a trusted root, and the `bundle_file_path` may be elided.

Key files must contain a single PEM encoded key. The supported key types are EC (ASN.1 or PKCS8 encoded) or RSA (PKCS1 or PKCS8 encoded).

A sample configuration:

```
    UpstreamCA "disk" {
        plugin_data {
            ttl = "1h"
            cert_file_path = "conf/server/dummy_upstream_ca.crt"
            key_file_path = "conf/server/dummy_upstream_ca.key"
        }
    }
```
